package org.inchain.network;

import java.net.InetSocketAddress;

import org.inchain.Configure;
import org.inchain.crypto.Sha256Hash;
import org.inchain.message.DefaultMessageSerializer;
import org.inchain.message.MessageSerializer;
import org.inchain.store.BlockStore;
import org.inchain.utils.Hex;
import org.inchain.utils.Utils;

/**
 * 测试网络
 * @author ln
 *
 */
public class TestNetworkParams extends NetworkParams {

	public TestNetworkParams() {
		seedManager = new RemoteSeedManager();

		seedManager.addDnsSeed("test1.seed.inchain.org");
		seedManager.addDnsSeed("test2.seed.inchain.org");

//    	seedManager.add(new Seed(new InetSocketAddress("47.93.16.125", Configure.DEFAULT_PORT)));
//    	seedManager.add(new Seed(new InetSocketAddress("119.23.249.26", Configure.DEFAULT_PORT)));
//   	seedManager.add(new Seed(new InetSocketAddress("119.23.253.3", Configure.DEFAULT_PORT)));
//    	seedManager.add(new Seed(new InetSocketAddress("119.23.254.99", Configure.DEFAULT_PORT)));
//		seedManager.add(new Seed(new InetSocketAddress("192.168.1.190", Configure.DEFAULT_PORT)));
//		seedManager.add(new Seed(new InetSocketAddress("192.168.1.186", Configure.DEFAULT_PORT)));
		init();
	}


	public TestNetworkParams(SeedManager seedManager) {
		this.seedManager = seedManager;
		init();
	}

	private void init() {

		id = ID_TESTNET;

		packetMagic = 629266579L;

		this.acceptableAddressCodes = new int[] {getSystemAccountVersion(), getCertAccountVersion()};
	}

	/**
	 * 测试网络的创世块
	 */
	@Override
	public BlockStore getGengsisBlock() {
		BlockStore gengsisBlock = new BlockStore(this, Hex.decode("00000000000000000000000000000000000000000000000000000000000000000000000044253791a13df8788faaf4b6da318000cc2ca7e68d1fc75880c0610ecd3aeec321d3695900000000000021d36959822102883a9625a871e79c070e316edafc97eac2f6c97b218d0e55726f25be2a963e9276a9144237cccf6ff9a7674a8fc47c60278fdd23e9f3098846304402206e1020421b146fc003e8eea1f7f591fe7c0cc953936418c4a68294d83e2ae2de022054ea172eb76cab32813c34444b4890334ed27616e1df95f62356425b3f5447bfac140101000000010012117468697320612067656e6773697320747800000000010080faca73f91f00000000001976a914bb7e4d6ffb3266a0b533b21847bef4dacce95f4688ac21d369590000000000020100000001019a271e90c75bed198c72b6cf929652260f33548761474215c30ca14702194d18000000006b483045022100db8e81751eb85bd22482b433fd5e964aa9b4fec6f68dde890d7e8232883ed5a8022014e49e20dab6dc51fa3c0ab68bb8da183bc88576d6bc36c8be4d4dc3bf856c4701210276c52ff14acd4c4d3e08f9596e0127a15e98207b3d0024426364825cd724c86dffffffff020080c6a47e8d03000078c2481976a9144237cccf6ff9a7674a8fc47c60278fdd23e9f30988ac00003426f56b1c00000000001976a914bb7e4d6ffb3266a0b533b21847bef4dacce95f4688ac21d369590000000000060100000021d3695900000000832102883a9625a871e79c070e316edafc97eac2f6c97b218d0e55726f25be2a963e9276a9144237cccf6ff9a7674a8fc47c60278fdd23e9f30988473045022100f6300f37a4029e229d2b77d03c68dfdc288264cdb859d4ee25467a838ee16939022050527335bf495436f924cdce74d1c4e80c902872b48f54be4d034d51e72995efac4237cccf6ff9a7674a8fc47c60278fdd23e9f30901000000000000000000000000000000000000000000000000000000000000000000000000000000000201000000010167d3b2ee7a0bb3eee399bfc5bfd4b5794ddf805bd3ad914db9605b68dbfbe4d6010000006b483045022100dd9f3b7c3b3dac87448918b5c971298c22840fcaa3f1f8b7873a188fa911deab0220543571b604879bfc4e1904918e8e6e72050b5aafd493c6a5b4a0ef7ed7c1f02c01210276c52ff14acd4c4d3e08f9596e0127a15e98207b3d0024426364825cd724c86dffffffff020010a5d4e8000000000000001976a9144237cccf6ff9a7674a8fc47c60278fdd23e9f30988ac00f08e510c6b1c00000000001976a914bb7e4d6ffb3266a0b533b21847bef4dacce95f4688ac21d3695900000000000301000000000021d369590000000000822102883a9625a871e79c070e316edafc97eac2f6c97b218d0e55726f25be2a963e9276a9144237cccf6ff9a7674a8fc47c60278fdd23e9f3098846304402205b2f3dfc54161ef8b2d7b1a5b307ef9e64a0738ec26dbf65c1cb6ce5b75d584002202b9ffedd8d40be02a17e5c8d48ba241ce954ba7437ca877999071172fd4b8350acdcba60454237cccf6ff9a7674a8fc47c60278fdd23e9f309060100000021d3695900000000832103a7db4a854e3f2ae3a30aa759bfd39045f6a80c967b3fd81036acebc54b557ece76a9142c1179b1e05fb8652644f6c61a033d284310091288473045022100c6ded6d03f058d9be6a071fd7e6a0d4945da66a5cf312f6c586230e555cffc97022034ed934683f9a97911404df4c1ffe901d27f6b69eaf246b53ed37918ef70048fac2c1179b1e05fb8652644f6c61a033d284310091201000000000000000000000000000000000000000000000000000000000000000000000000000000000201000000010126579d6f64f74deb8cf8b4fdaac47a9e193e621478ec7690bfd44aaf153a58f6010000006b483045022100a1a39f0a0b6bb92b34658cdbf1c29614bf1b3062c28110815926a923b147335f022040520f009b7c3e55b6326704ef39b903f75f6fb1c506b7b789a4fe551e5f99a001210276c52ff14acd4c4d3e08f9596e0127a15e98207b3d0024426364825cd724c86dffffffff020010a5d4e8000000000000001976a9142c1179b1e05fb8652644f6c61a033d284310091288ac00e0e97c236a1c00000000001976a914bb7e4d6ffb3266a0b533b21847bef4dacce95f4688ac21d3695900000000000301000000000021d369590000000000822103a7db4a854e3f2ae3a30aa759bfd39045f6a80c967b3fd81036acebc54b557ece76a9142c1179b1e05fb8652644f6c61a033d284310091288463044022022a5678a4a8afbb289bbffceeba1c8acd32e22aa34e9edcfd8f58c26c003969c02203ee86fb29abe92633cf280321f7b28f2ab2c9279b3a21d22af5b7e3b6a6c2c5eacebba60452c1179b1e05fb8652644f6c61a033d2843100912060100000021d36959000000008321033e371b2f3d42dd525833bcce12cb0d404fb73898bdea3e6794bd8ec552c9ba9c76a914b3fcd687a5c2b2617de0d504cfa7d12db93bb00c88473045022100f5ab22245e13985557aac76f4192e6f7bff7da6293c79f44b7cf6c5d5a03c7570220554981478fa35368a2890b0f430f864e1e9f8d8f0a89a9d34c6dd906285cb738acb3fcd687a5c2b2617de0d504cfa7d12db93bb00c010000000000000000000000000000000000000000000000000000000000000000000000000000000002010000000101aee4e8bfb25952528d480c11b2b86bdfa71c6a71d1e44a74f62a436ed75d96bd010000006a47304402202c9edc94e4a793c10037165366341d707440b9c4c6ea91034c98439f5334d5ef022039c216613a45f12bd3c2a578c2d90ae3bab53888392b346c8f08d3318b397b7401210276c52ff14acd4c4d3e08f9596e0127a15e98207b3d0024426364825cd724c86dffffffff020010a5d4e8000000000000001976a914b3fcd687a5c2b2617de0d504cfa7d12db93bb00c88ac00d044a83a691c00000000001976a914bb7e4d6ffb3266a0b533b21847bef4dacce95f4688ac21d3695900000000000301000000000021d3695900000000008221033e371b2f3d42dd525833bcce12cb0d404fb73898bdea3e6794bd8ec552c9ba9c76a914b3fcd687a5c2b2617de0d504cfa7d12db93bb00c88463044022075b687672d5ff89158d566b4c3b819e943506e963d72840b68868fa0965ec22a02204e447a4854ddfbbc536de6261584e1f7d6f2a67e5a8fad05c2037956d9ae031eacefba6045b3fcd687a5c2b2617de0d504cfa7d12db93bb00c060100000021d3695900000000822103bf7759e9b81f8ff1b99732b3ee36aea0abff68c818b8839c318ad350e9642cb076a914c3bfdb8a67f35b6e4ea1ee3ae7b91eff58ec81a88846304402202323b4123899c0f80c3ef7747608af30d180427db25df83dd4f309b46e82692c0220716eeb59d544c2fca5131d13a3fd17d51e59e7b6c0d5d871ac15a06b7bafb3e2acc3bfdb8a67f35b6e4ea1ee3ae7b91eff58ec81a80100000000000000000000000000000000000000000000000000000000000000000000000000000000020100000001012d72f5bc9fade1a5ee3de1e1478f0b1c4a2c1cc756b03a1c07b4b2abdaee6639010000006b483045022100d39349b1bb3f4445b04db4e2403927029a58cdd02027507b76f93c22edda8bfe0220031828beb19aac3f7864bbf6477a8a73c5aa62558cc9beea82307575dbee70d001210276c52ff14acd4c4d3e08f9596e0127a15e98207b3d0024426364825cd724c86dffffffff020010a5d4e8000000000000001976a914c3bfdb8a67f35b6e4ea1ee3ae7b91eff58ec81a888ac00c09fd351681c00000000001976a914bb7e4d6ffb3266a0b533b21847bef4dacce95f4688ac21d369590000000000060100000021d369590000000082210200d482122f8537ad2fa1af1914e088d6b308824a8ef4dc8b68fa0e0a88c484e376a9145f1a078b610d92a3110b2c1a7f880b0d2442e530884630440220070de09b60b8fddfbec5ff30aa3b36f99f456ba7be5e8e53f9787b303ca5b7b702207775e7996dc4875b1255adf1c8e2dab87add940aae3672049cd6145e4b95de0dac5f1a078b610d92a3110b2c1a7f880b0d2442e53001000000000000000000000000000000000000000000000000000000000000000000000000000000000201000000010166c37ccd68a1b0c86cf5a344def145ceaf85d7e3410d79b2e40cd86ac645b7de010000006a4730440220158c3830c69f7e29896142548640ee566680117152cba3b9abd564a4af47c06e0220513f210fe36017b2fa0b7ac486b1edbfb3da40fe468995c01fb00ea65a3416c701210276c52ff14acd4c4d3e08f9596e0127a15e98207b3d0024426364825cd724c86dffffffff020010a5d4e8000000000000001976a9145f1a078b610d92a3110b2c1a7f880b0d2442e53088ac00b0fafe68671c00000000001976a914bb7e4d6ffb3266a0b533b21847bef4dacce95f4688ac21d369590000000000060100000021d3695900000000832103e8769d1901a4ef006054405c16716d6648fffe628385db5586c7fa18c3df5da876a914df639c6066a817a6be28b532839f8e1e85594cd488473045022100ebb51f634d69e8c708502660c29003e9a0effd046385f6f920a7cf2c47c743ff022048168065e3305012200506a7b349237d0d44b284e4fb07a7cbcf2e41bca06bccacdf639c6066a817a6be28b532839f8e1e85594cd40100000000000000000000000000000000000000000000000000000000000000000000000000000000020100000001016e895847e881132f95e524caea8b7cc1bca0e14a02316b0bb06e0f33fe70aa1b010000006a47304402206581f09b9d4709c4743249582aee9bf756158c9210ce4db6b29da678ddb8132e02207010608b74b9f01f57887383d28e5b884288f3198d36319cce02c7a69be5ed1f01210276c52ff14acd4c4d3e08f9596e0127a15e98207b3d0024426364825cd724c86dffffffff020010a5d4e8000000000000001976a914df639c6066a817a6be28b532839f8e1e85594cd488ac00a0552a80661c00000000001976a914bb7e4d6ffb3266a0b533b21847bef4dacce95f4688ac21d369590000000000060100000021d3695900000000832103368f8061e02694e37da199c07c3e2f2506cdd748efee493f0d1c52ae7494428f76a914e3453a80144f6ac24baf01f20455c6167b98548588473045022100a2177f422a08d51b7c5ccc49f88a4183b012d16439c26fb8981532010531db660220792b9d8afbd09ed7c39e0df0a033480a5b3577798cdfdb59b392a36a8bfec43bace3453a80144f6ac24baf01f20455c6167b98548501000000000000000000000000000000000000000000000000000000000000000000000000000000000201000000010117136d5513f24d0d61000508d7e48841be60d9f85af702d1139449f13d9e1395010000006a4730440220578ce56fe8612ef551cdd544c84262d1eeaf5a2a7fe050c9f49c37691c3259a90220080af345fdfa8cf835bc6775fd880481b589dd454247f11755b93df8b182d75601210276c52ff14acd4c4d3e08f9596e0127a15e98207b3d0024426364825cd724c86dffffffff020010a5d4e8000000000000001976a914e3453a80144f6ac24baf01f20455c6167b98548588ac0090b05597651c00000000001976a914bb7e4d6ffb3266a0b533b21847bef4dacce95f4688ac21d3695900000000000b010000004d730a455d010000aaf2fe9256fcc74c959f59089f70acbad6880d0aaaf2fe9256fcc74c959f59089f70acbad6880d0a02fd23022b046e616d6506e5908de7a7b01ee9878de5ba86e58db0e993bee7a791e68a80e69c89e99990e585ace58fb822076164647265737306e59cb0e59d8012e9878de5ba86e5b882e58d97e5b2b8e58cba44046c6f676f06e59bbee7898737687474703a2f2f66696c652e696e636861696e2e6f72672f696d616765732f696e636861696e5f6c6f676f5f313030783130302e706e672b0a637265646974436f64650ce4bfa1e794a8e4bba3e7a0811239313530303130384d41355542333248334e1a0570686f6e6506e794b5e8af9d0c3032332d383633333130363927077765627369746506e5ae98e7bd911768747470733a2f2f7777772e696e636861696e2e6f7267fd1d0108646573637269707406e68f8fe8bfb0fd0a01e9878de5ba86e58db0e993bee7a791e68a80e69c89e99990e585ace58fb8e698afe4b880e5aeb6e4bba5e58cbae59d97e993bee68a80e69cafe9a9b1e58aa8e79a84e5889be696b0e59e8be4bc81e4b89aefbc8ce585b6e4b8bbe5afbce79a84e58cbae59d97e993bee7a4bee58cbae9a1b9e79bae496e636861696e2de58db0e993bee698afe4b880e4b8aae4bba5e998b2e4bcaae4b8bae59fbae7a180e4b89ae58aa1e79a84e585ace5bc80e5b9b3e58fb0efbc8ce4b8bae7a4bee4bc9ae59084e4bc81e4b89ae38081e69cbae69e84e38081e889bae69cafe5aeb6e7ad89e68f90e4be9be59381e7898ce38081e79fa5e8af86e4baa7e69d83e4bf9de68aa4e69c8de58aa1e380820221023a625a5fe42a9897dfeec5885357720a2c6046e2fc997c16bc176dee74f0cfe921032b2634772caa118c85b99bb7e7966ec2d0ef49df5bd52e975f7360d6a71924e901210331ab026abee8e408c6865c6baba6f2c010ecb1cdcea3a7f1a351bf7878c846fa82c22032516626efe2e1bd1dbfc88e692ee7b267594b96d8c6703695efca612a6654aec314716b68dd463d01263a7ff4a7c52eae528d7143968847304502210083d703ad800de20e3898b988aebc027ec02db485f30c3d6abbbb7b369983f64e02204617d3c93cc3d4a05a35f9e9c8d9285b6360afc72ca65dacbfb37d037140d3a0ac"));

		Sha256Hash merkleHash = gengsisBlock.getBlock().buildMerkleHash();

		if(log.isDebugEnabled()) {
			log.debug("the gengsis block merkle hash is : {}", merkleHash);
		}
		Utils.checkState("44253791a13df8788faaf4b6da318000cc2ca7e68d1fc75880c0610ecd3aeec3".equals(Hex.encode(merkleHash.getBytes())), "the gengsis block merkle hash is error");

		if(log.isDebugEnabled()) {
			log.debug("the gengsis block hash key is : {}", gengsisBlock.getBlock().getHash());
		}
		Utils.checkState("3f553e148fe68473eb3b9f51dee19f9a54e401dfed1acd546c69b3c103fa4960".equals(Hex.encode(gengsisBlock.getBlock().getHash().getBytes())), "the gengsis block hash is error");

		return gengsisBlock;

	}

	@Override
	public int getProtocolVersionNum(ProtocolVersion version) {
		return version.getVersion();
	}

	@Override
	public MessageSerializer getSerializer(boolean parseRetain) {
		return new DefaultMessageSerializer(this);
	}

	/**
	 * 获取该网络的认证管理账号的hash160
	 * @return byte[]
	 */
	@Override
	public byte[] getCertAccountManagerHash160() {


		//return Hex.decode("8e168bb4963f0523b9ee1c734d3c142976581930");//root
		//return Hex.decode("b326aeb9c6710864441b7c6a282ce924b4c31749");//manager
		return Hex.decode("481e05c83604abf86cca029c4260674c45c85c58");//cer_manager_1
	}

	@Override
	public byte[] getCommunityManagerHash160() {
		return Hex.decode("481e05c83604abf86cca029c4260674c45c85c58");//cer_manager_1
	}

	/**
	 * 测试网络，普通地址以t开头
	 */
	@Override
	public int getSystemAccountVersion() {
		return 128;
	}

	/**
	 * 测试网络，认证地址以c开头
	 */
	@Override
	public int getCertAccountVersion() {
		return 88;
	}
}
