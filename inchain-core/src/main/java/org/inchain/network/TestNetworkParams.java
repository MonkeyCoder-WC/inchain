package org.inchain.network;

import java.net.InetSocketAddress;

import org.inchain.Configure;
import org.inchain.crypto.Sha256Hash;
import org.inchain.message.DefaultMessageSerializer;
import org.inchain.message.MessageSerializer;
import org.inchain.store.BlockStore;
import org.inchain.utils.Hex;
import org.inchain.utils.Utils;

/**
 * 测试网络
 * @author ln
 *
 */
public class TestNetworkParams extends NetworkParams {

	public TestNetworkParams() {
		seedManager = new RemoteSeedManager();

		seedManager.addDnsSeed("test1.seed.inchain.org");
		seedManager.addDnsSeed("test2.seed.inchain.org");

//    	seedManager.add(new Seed(new InetSocketAddress("47.93.16.125", Configure.DEFAULT_PORT)));
//    	seedManager.add(new Seed(new InetSocketAddress("119.23.249.26", Configure.DEFAULT_PORT)));
//   	seedManager.add(new Seed(new InetSocketAddress("119.23.253.3", Configure.DEFAULT_PORT)));
//    	seedManager.add(new Seed(new InetSocketAddress("119.23.254.99", Configure.DEFAULT_PORT)));
//		seedManager.add(new Seed(new InetSocketAddress("192.168.1.190", Configure.DEFAULT_PORT)));
//		seedManager.add(new Seed(new InetSocketAddress("192.168.1.186", Configure.DEFAULT_PORT)));
		init();
	}


	public TestNetworkParams(SeedManager seedManager) {
		this.seedManager = seedManager;
		init();
	}

	private void init() {

		id = ID_TESTNET;

		packetMagic = 629266579L;

		this.acceptableAddressCodes = new int[] {getSystemAccountVersion(), getCertAccountVersion()};
	}

	/**
	 * 测试网络的创世块
	 */
	@Override
	public BlockStore getGengsisBlock() {
		BlockStore gengsisBlock = new BlockStore(this, Hex.decode("0000000000000000000000000000000000000000000000000000000000000000000000005b90eb9c42ab12423aeba5d66d1c3ca7e77ae7f0390b30553af1dcd211a4ed5157ec695900000000000057ec6959832102883a9625a871e79c070e316edafc97eac2f6c97b218d0e55726f25be2a963e9276a9144237cccf6ff9a7674a8fc47c60278fdd23e9f30988473045022100bfdd1bc47ab836ba87c4e9aee6928bf4f7e2400fd40004a8bee97ba8e6f40b7e02202ed4c2bcc70c292adb1171770dda7c7b03e18d6424f3d34dbe59929d295a3203ac140101000000010012117468697320612067656e6773697320747800000000010080faca73f91f00000000001976a914bb7e4d6ffb3266a0b533b21847bef4dacce95f4688ac57ec6959000000000002010000000101ff83f3a383f559e7dce62b271637dd7f76de35ab07401d96d74a34136ce5f0e8000000006b483045022100f80021800eaf55a9b79d1c3da33ceb61044e65a414a5815769dc1995260929b1022016da10e116d369eec02a2d45d631d04f3f00bfd5e48336294f42adbee4df6b2901210276c52ff14acd4c4d3e08f9596e0127a15e98207b3d0024426364825cd724c86dffffffff020080c6a47e8d03000078c2481976a9144237cccf6ff9a7674a8fc47c60278fdd23e9f30988ac00003426f56b1c00000000001976a914bb7e4d6ffb3266a0b533b21847bef4dacce95f4688ac57ec69590000000000060100000057ec695900000000822102883a9625a871e79c070e316edafc97eac2f6c97b218d0e55726f25be2a963e9276a9144237cccf6ff9a7674a8fc47c60278fdd23e9f309884630440220206c548520608ba011d9e038fa16b4a49f7f9d31400c775e381952a320153547022066f8379d709904b2d1458e5adec5e4a77a07744f2626336d6e5e8a2f8c73400fac4237cccf6ff9a7674a8fc47c60278fdd23e9f309010000000000000000000000000000000000000000000000000000000000000000000000000000000002010000000101c5273cdaa34c4f8562819bef8c66abb0d412c2e7d5d442edf3274336bb9f3392010000006b483045022100eea37975d51bfd76fc56135e66dbb8e8b60c24053f2da867903588423ccdff5c02202ac429ffa1889ca74e2b24fb41ff751048b31d063a1ae17fe1b3be802f3eeb0201210276c52ff14acd4c4d3e08f9596e0127a15e98207b3d0024426364825cd724c86dffffffff020010a5d4e8000000000000001976a9144237cccf6ff9a7674a8fc47c60278fdd23e9f30988ac00f08e510c6b1c00000000001976a914bb7e4d6ffb3266a0b533b21847bef4dacce95f4688ac57ec695900000000000301000000000057ec69590000000000822102883a9625a871e79c070e316edafc97eac2f6c97b218d0e55726f25be2a963e9276a9144237cccf6ff9a7674a8fc47c60278fdd23e9f3098846304402201f6f40d45608155fa6c4d737691d5406d10d4b6022727014a7cc5a56330590f802204c47b7e85779f56e458dcfb49f20deec81e9349ca0d0241738b5d5f2ab75ab51ac3a35c3454237cccf6ff9a7674a8fc47c60278fdd23e9f309060100000057ec695900000000832103a7db4a854e3f2ae3a30aa759bfd39045f6a80c967b3fd81036acebc54b557ece76a9142c1179b1e05fb8652644f6c61a033d284310091288473045022100da019c3116331632688a4db2018dead0bd7870ac4dede1be28776e93aea48e12022045369db7c12df1f358c7d47e3979826ac5eadb4e5a55d1c1b8cf0ce57c6e46b5ac2c1179b1e05fb8652644f6c61a033d2843100912010000000000000000000000000000000000000000000000000000000000000000000000000000000002010000000101372e9733ffdfcc12ea33fde0b01be5548d6316a7dc9ac3cc6d8fcd5813dd8b80010000006a47304402203f37b796a5eb8b11f9f96bcf5e7dca10463359df284031133ac0d82e8cce60c502202568178a2c9e57f9334228d6017c8dc30f118f1fed88e9027d557cf0d99e106801210276c52ff14acd4c4d3e08f9596e0127a15e98207b3d0024426364825cd724c86dffffffff020010a5d4e8000000000000001976a9142c1179b1e05fb8652644f6c61a033d284310091288ac00e0e97c236a1c00000000001976a914bb7e4d6ffb3266a0b533b21847bef4dacce95f4688ac57ec695900000000000301000000000057ec69590000000000822103a7db4a854e3f2ae3a30aa759bfd39045f6a80c967b3fd81036acebc54b557ece76a9142c1179b1e05fb8652644f6c61a033d28431009128846304402202fdf263d3ec0881db8007a599c063b2f744d6e55363e46d69b4c57a0a3872a3602202ff96b04541cc0defb33523b0268fb6d14c7f3ca9859bd0598b6939d3bf03e8fac4a35c3452c1179b1e05fb8652644f6c61a033d2843100912060100000057ec6959000000008321033e371b2f3d42dd525833bcce12cb0d404fb73898bdea3e6794bd8ec552c9ba9c76a914b3fcd687a5c2b2617de0d504cfa7d12db93bb00c88473045022100c72f6b8d2d1cd9615cc750deb21abfde0887768dfa25df3971910b926be776ff02200be2bdeadd75883f7289a72e0bed3575402f43424ab435409742bc58f4b21e9bacb3fcd687a5c2b2617de0d504cfa7d12db93bb00c01000000000000000000000000000000000000000000000000000000000000000000000000000000000201000000010174a7934b724226fc51b17a08f261e4b2e04197936f39ccf4e1b7dc1712f08ba1010000006b4830450221009fa686f07b40afa3707af5b7fe422499f0022acecd8c1adcc8007ad8a5039252022013fe1f13e6ca3961e6151d8049eba826de3fd6f6335ce0534a9b2c4c62fa34d501210276c52ff14acd4c4d3e08f9596e0127a15e98207b3d0024426364825cd724c86dffffffff020010a5d4e8000000000000001976a914b3fcd687a5c2b2617de0d504cfa7d12db93bb00c88ac00d044a83a691c00000000001976a914bb7e4d6ffb3266a0b533b21847bef4dacce95f4688ac57ec695900000000000301000000000057ec695900000000008321033e371b2f3d42dd525833bcce12cb0d404fb73898bdea3e6794bd8ec552c9ba9c76a914b3fcd687a5c2b2617de0d504cfa7d12db93bb00c88473045022100f18bde0f263500f6a274b6a112e3f5038241712bfe92ca430be84516adeea8ac02205578753f1b59e8bd225db76ced8a8139c426c12c0543c7f5b4fc435a4b1bb918ac4e35c345b3fcd687a5c2b2617de0d504cfa7d12db93bb00c060100000057ec695900000000832103bf7759e9b81f8ff1b99732b3ee36aea0abff68c818b8839c318ad350e9642cb076a914c3bfdb8a67f35b6e4ea1ee3ae7b91eff58ec81a888473045022100ca327d0af9f990cdf76379981668f474e43fe6ce881cfdf1cc841baa70ee3a6a0220245b7dd50e2eaea9f3a98b43e58a0bd1139a0e3d84aff1e4f2f0ba817e2f0056acc3bfdb8a67f35b6e4ea1ee3ae7b91eff58ec81a8010000000000000000000000000000000000000000000000000000000000000000000000000000000002010000000101b461ab104adb427c94cb4da40b29a6347e2e4965629090939b782c75d93d3356010000006b483045022100c93f6c9d1a43af2592e90d63f53f89419cdbe38e28d2e2d7036c1c1a42e8419f02202558f1be04d2d5072376da049b4cc40a71be40f404078be13e6f8c0443a0d94201210276c52ff14acd4c4d3e08f9596e0127a15e98207b3d0024426364825cd724c86dffffffff020010a5d4e8000000000000001976a914c3bfdb8a67f35b6e4ea1ee3ae7b91eff58ec81a888ac00c09fd351681c00000000001976a914bb7e4d6ffb3266a0b533b21847bef4dacce95f4688ac57ec69590000000000060100000057ec69590000000083210200d482122f8537ad2fa1af1914e088d6b308824a8ef4dc8b68fa0e0a88c484e376a9145f1a078b610d92a3110b2c1a7f880b0d2442e53088473045022100b4dbcee09c7635cdd8f2bc982a689f91a3e0da1e2175511a685fd3419a37a0e802203d884e1644ae857a911ad8108dd45277f49d14d30cdcefa8549b9fc613c396a8ac5f1a078b610d92a3110b2c1a7f880b0d2442e5300100000000000000000000000000000000000000000000000000000000000000000000000000000000020100000001018242ca039619f497a6c39b6650ed634d778e7ea02f6de8015b6563c9ba46c6d7010000006b483045022100e25ef1d5776736b4f97996bea32f83b37145c665078f67c76307d98c653541cf022076cba8bc024daaacc8b85c846248f3e7fa8db1f9dd52f8b975560eb82b8e723b01210276c52ff14acd4c4d3e08f9596e0127a15e98207b3d0024426364825cd724c86dffffffff020010a5d4e8000000000000001976a9145f1a078b610d92a3110b2c1a7f880b0d2442e53088ac00b0fafe68671c00000000001976a914bb7e4d6ffb3266a0b533b21847bef4dacce95f4688ac57ec69590000000000060100000057ec695900000000822103e8769d1901a4ef006054405c16716d6648fffe628385db5586c7fa18c3df5da876a914df639c6066a817a6be28b532839f8e1e85594cd48846304402203d9dccaa8e66b71c6dc6c5449818ffd866eb27d3e1850ab4960ef31a50c6e9f102202aa1d33dca67da52b7af65dfa193ccdf53525274a2687f95335a4ed6766da92aacdf639c6066a817a6be28b532839f8e1e85594cd401000000000000000000000000000000000000000000000000000000000000000000000000000000000201000000010109f2c3d8bafd5ac38044f8eb79e5feae4049afebf23de941e06ec2e622f6160a010000006b483045022100dd793001305fe6217bd3368e80ed6d052cb595d98ddbaecdfdb77390d2476d7702201387e026bc5fe840adf0511878f67c10ed03136fdba3a6ebc8adef025023c18301210276c52ff14acd4c4d3e08f9596e0127a15e98207b3d0024426364825cd724c86dffffffff020010a5d4e8000000000000001976a914df639c6066a817a6be28b532839f8e1e85594cd488ac00a0552a80661c00000000001976a914bb7e4d6ffb3266a0b533b21847bef4dacce95f4688ac57ec69590000000000060100000057ec695900000000832103368f8061e02694e37da199c07c3e2f2506cdd748efee493f0d1c52ae7494428f76a914e3453a80144f6ac24baf01f20455c6167b98548588473045022100e99ebd1374269a3e868f49fccf091309e2c645802eceadbea2bab23b7825e92d02207452b3116b6a3768390d9a5d08fc6dd84af97fd4622f7c0f23779ed1093d5d12ace3453a80144f6ac24baf01f20455c6167b985485010000000000000000000000000000000000000000000000000000000000000000000000000000000002010000000101bb0aa90418c29f138796378e08849d738ad092e5963ebf80e5e0b0947de4251d010000006a47304402204346fd70e1a6ae146bb1daa3aa316406c4bbafa6a9fe7da5b87d37cb94a3daf102202a4717198a1b394a8c088fe891ebd2fb4a92d0581ff3c019c44cfe8ddaf1f9d201210276c52ff14acd4c4d3e08f9596e0127a15e98207b3d0024426364825cd724c86dffffffff020010a5d4e8000000"));

		Sha256Hash merkleHash = gengsisBlock.getBlock().buildMerkleHash();

		if(log.isDebugEnabled()) {
			log.debug("the gengsis block merkle hash is : {}", merkleHash);
		}
		Utils.checkState("5b90eb9c42ab12423aeba5d66d1c3ca7e77ae7f0390b30553af1dcd211a4ed51".equals(Hex.encode(merkleHash.getBytes())), "the gengsis block merkle hash is error");

		if(log.isDebugEnabled()) {
			log.debug("the gengsis block hash key is : {}", gengsisBlock.getBlock().getHash());
		}
		Utils.checkState("a7e0edac86b73dceeb3dee57be85711349486a5c56ba463595fdadca4f74e550".equals(Hex.encode(gengsisBlock.getBlock().getHash().getBytes())), "the gengsis block hash is error");

		return gengsisBlock;

	}

	@Override
	public int getProtocolVersionNum(ProtocolVersion version) {
		return version.getVersion();
	}

	@Override
	public MessageSerializer getSerializer(boolean parseRetain) {
		return new DefaultMessageSerializer(this);
	}

	/**
	 * 获取该网络的认证管理账号的hash160
	 * @return byte[]
	 */
	@Override
	public byte[] getCertAccountManagerHash160() {


		//return Hex.decode("8e168bb4963f0523b9ee1c734d3c142976581930");//root
		//return Hex.decode("b326aeb9c6710864441b7c6a282ce924b4c31749");//manager
		return Hex.decode("481e05c83604abf86cca029c4260674c45c85c58");//cer_manager_1
	}

	@Override
	public byte[] getCommunityManagerHash160() {
		return Hex.decode("481e05c83604abf86cca029c4260674c45c85c58");//cer_manager_1
	}

	/**
	 * 测试网络，普通地址以t开头
	 */
	@Override
	public int getSystemAccountVersion() {
		return 128;
	}

	/**
	 * 测试网络，认证地址以c开头
	 */
	@Override
	public int getCertAccountVersion() {
		return 88;
	}
}
