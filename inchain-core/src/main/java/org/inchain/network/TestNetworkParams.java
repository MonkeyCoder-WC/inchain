package org.inchain.network;

import java.net.InetSocketAddress;

import org.inchain.Configure;
import org.inchain.crypto.Sha256Hash;
import org.inchain.message.DefaultMessageSerializer;
import org.inchain.message.MessageSerializer;
import org.inchain.store.BlockStore;
import org.inchain.utils.Hex;
import org.inchain.utils.Utils;

/**
 * 测试网络
 * @author ln
 *
 */
public class TestNetworkParams extends NetworkParams {

	public TestNetworkParams() {
		seedManager = new RemoteSeedManager();

//		seedManager.addDnsSeed("test1.seed.inchain.org");
//		seedManager.addDnsSeed("test2.seed.inchain.org");

//    	seedManager.add(new Seed(new InetSocketAddress("47.93.16.125", Configure.DEFAULT_PORT)));
//    	seedManager.add(new Seed(new InetSocketAddress("119.23.249.26", Configure.DEFAULT_PORT)));
//   	seedManager.add(new Seed(new InetSocketAddress("119.23.253.3", Configure.DEFAULT_PORT)));
//    	seedManager.add(new Seed(new InetSocketAddress("119.23.254.99", Configure.DEFAULT_PORT)));
		seedManager.add(new Seed(new InetSocketAddress("192.168.1.190", Configure.DEFAULT_PORT)));
        seedManager.add(new Seed(new InetSocketAddress("192.168.1.186", Configure.DEFAULT_PORT)));
		init();
	}
    

	public TestNetworkParams(SeedManager seedManager) {
    	this.seedManager = seedManager;
    	init();
	}
    
	private void init() {
		
		id = ID_TESTNET;
		
		packetMagic = 629266579L;
		
		this.acceptableAddressCodes = new int[] {getSystemAccountVersion(), getCertAccountVersion()};
	}
	
	/**
	 * 测试网络的创世块
	 */
	@Override
	public BlockStore getGengsisBlock() {
		BlockStore gengsisBlock = new BlockStore(this, Hex.decode("000000000000000000000000000000000000000000000000000000000000000000000000c78001cd9d306a5ccaa0a3cf72390910bd82e12eecac71152948b0c16725d08f92bd695900000000000092bd6959832102883a9625a871e79c070e316edafc97eac2f6c97b218d0e55726f25be2a963e9276a9144237cccf6ff9a7674a8fc47c60278fdd23e9f30988473045022100b6e8df465b5b292adc2f873eff238c31c6e4b518d99d83c482bf7c0e32f18a4f02204fa0d113f1f3bcb3b7351cad8e7d5db1605403352b545b909b703ce14766a2cfac130101000000010012117468697320612067656e6773697320747800000000010080faca73f91f00000000001976a914bb7e4d6ffb3266a0b533b21847bef4dacce95f4688ac92bd6959000000000002010000000101f9423d80918b6518b5fa4f5d6b01a0c619c11f6b2d624786eccb52514e1533ce000000006b4830450221008c2727af6ed5e19ac1239593ab3653b70747fa25ed34a4bfbfb2668d876dd60c022017ff85e8fd31ae1e264eea7a029d9374bfcd77b150524723cf8c58898479191d01210276c52ff14acd4c4d3e08f9596e0127a15e98207b3d0024426364825cd724c86dffffffff020080c6a47e8d03000078c2481976a9144237cccf6ff9a7674a8fc47c60278fdd23e9f30988ac00003426f56b1c00000000001976a914bb7e4d6ffb3266a0b533b21847bef4dacce95f4688ac93bd69590000000000060100000093bd695900000000832102883a9625a871e79c070e316edafc97eac2f6c97b218d0e55726f25be2a963e9276a9144237cccf6ff9a7674a8fc47c60278fdd23e9f3098847304502210092d54e703469d4236a5eda8470da79d2da74568d138ee5a9292c98e6bff867b4022025f09b0d6371f39fa2f4ca6cf0b28cf477dbd52fb50ea2d337350162f0c636e0ac4237cccf6ff9a7674a8fc47c60278fdd23e9f3097f9698000000000000000000000000000000000000000000000000000000000000000000000000000002010000000101c8a71ff1fd2b55977de93ec52fe334ddaaeed99b68e8023d48909bac111214e2010000006a473044022030fe64f8b9d04fcc2249abf4255eed60e749f7970940b1d97a9fbab2488b40a3022064849eab206ae20fd03dde33568b17fae8cb2bca11bf4199a7777d78bd05608901210276c52ff14acd4c4d3e08f9596e0127a15e98207b3d0024426364825cd724c86dffffffff0200e8764817000000000000001976a9144237cccf6ff9a7674a8fc47c60278fdd23e9f30988ac0018bddddd6b1c00000000001976a914bb7e4d6ffb3266a0b533b21847bef4dacce95f4688ac93bd695900000000000301000000000093bd69590000000000822102883a9625a871e79c070e316edafc97eac2f6c97b218d0e55726f25be2a963e9276a9144237cccf6ff9a7674a8fc47c60278fdd23e9f30988463044022040e5165cf666910c78c79a6d5aae053d123d8f9da0c5ae2fabbd199f2c76a413022067dadcd46f88414bccb84df63aefe7cc7a4b6796b2efe9a0a0aabc1598dd1aabacfa860c454237cccf6ff9a7674a8fc47c60278fdd23e9f309060100000093bd695900000000832103a7db4a854e3f2ae3a30aa759bfd39045f6a80c967b3fd81036acebc54b557ece76a9142c1179b1e05fb8652644f6c61a033d2843100912884730450221008ccbb0030379e9f75028a13134742b1091d7e55c8dae9fb1ea39163b4d15d0310220114e6ba4363e51bc3cac00cda6498acfd2326bfaf04d39aa54b089c154381405ac2c1179b1e05fb8652644f6c61a033d28431009127f9698000000000000000000000000000000000000000000000000000000000000000000000000000002010000000101c01f935d60bb2943f980b67b0d37e549c4d3f4fd9c8c8278a3e775fe01f8ae75010000006a473044022023f8355817d3dd820ad71ccf67f2b494ea74b9e24640fa45890e7befb4e1126f022063321656320824d61789e65a8cc31d715087613e6d1606b1a446a6c2e1cab9b801210276c52ff14acd4c4d3e08f9596e0127a15e98207b3d0024426364825cd724c86dffffffff0200e8764817000000000000001976a9142c1179b1e05fb8652644f6c61a033d284310091288ac00304695c66b1c00000000001976a914bb7e4d6ffb3266a0b533b21847bef4dacce95f4688ac93bd695900000000000301000000000093bd69590000000000822103a7db4a854e3f2ae3a30aa759bfd39045f6a80c967b3fd81036acebc54b557ece76a9142c1179b1e05fb8652644f6c61a033d28431009128846304402206d7b781849c6d6fc1fe80e3c4756497542414eef1aab7ef5efea6fe0447ce15502207c86824efffcdd353f4121f2896f6730af41495e179d3517f13cb3f62d4c3de8ac0a870c452c1179b1e05fb8652644f6c61a033d2843100912060100000093bd6959000000008321033e371b2f3d42dd525833bcce12cb0d404fb73898bdea3e6794bd8ec552c9ba9c76a914b3fcd687a5c2b2617de0d504cfa7d12db93bb00c88473045022100c405ede19a31f1746bb03a057d06e66507b90310a25bcfc84db30ed9bb460f6002202c857cfca200b636baefb97a272ec8e7c88d0d050985e393b5a500de25044ea3acb3fcd687a5c2b2617de0d504cfa7d12db93bb00c7f969800000000000000000000000000000000000000000000000000000000000000000000000000000201000000010135824f584fdf28ed47cb48a91eaecf3669bd1d2b2ededb5df13ed3d325a73b3e010000006b483045022100ea8391721bac15d356358dd10567eca1a161f83d83b3f64f7a68ad98d4556a3a02207a32130b2605a2af0e7e31b825dd224ef6dc0a94f38cd963f266b81ab5061b1d01210276c52ff14acd4c4d3e08f9596e0127a15e98207b3d0024426364825cd724c86dffffffff0200e8764817000000000000001976a914b3fcd687a5c2b2617de0d504cfa7d12db93bb00c88ac0048cf4caf6b1c00000000001976a914bb7e4d6ffb3266a0b533b21847bef4dacce95f4688ac93bd695900000000000301000000000093bd695900000000008221033e371b2f3d42dd525833bcce12cb0d404fb73898bdea3e6794bd8ec552c9ba9c76a914b3fcd687a5c2b2617de0d504cfa7d12db93bb00c88463044022000932f1b83e27cab13900146a6664188537289ba01f01ac71535c78834f849b002201b815f1f45bdf6b7a5c583a52cdc5a543a72c9131a6674f4f6e0383241c100f7ac0e870c45b3fcd687a5c2b2617de0d504cfa7d12db93bb00c060100000093bd695900000000822103bf7759e9b81f8ff1b99732b3ee36aea0abff68c818b8839c318ad350e9642cb076a914c3bfdb8a67f35b6e4ea1ee3ae7b91eff58ec81a88846304402201249b34b52053d152070baef82cf92c78c82b045385c7fb0d935ffbdf76a70dd02206f09271a1a73e7ebfdb7a3a1ec466f203b4fef713c89477de69a0cfa85b46bb7acc3bfdb8a67f35b6e4ea1ee3ae7b91eff58ec81a87f9698000000000000000000000000000000000000000000000000000000000000000000000000000002010000000101f2cfd1d4e2e799b6904ace29d2af550772ebd0c6e8a432bef00bc56d8f75c70b010000006b483045022100ad5699aaaa26e94f3c57b6a92f3b3f2a1a91735287b1c5b048c1b5972ba716b302201827a377c21863f9375aa3eba2d628ebe62faf3fc8d54568d64a61166b52462001210276c52ff14acd4c4d3e08f9596e0127a15e98207b3d0024426364825cd724c86dffffffff0200e8764817000000000000001976a914c3bfdb8a67f35b6e4ea1ee3ae7b91eff58ec81a888ac00605804986b1c00000000001976a914bb7e4d6ffb3266a0b533b21847bef4dacce95f4688ac93bd69590000000000060100000093bd69590000000082210200d482122f8537ad2fa1af1914e088d6b308824a8ef4dc8b68fa0e0a88c484e376a9145f1a078b610d92a3110b2c1a7f880b0d2442e530884630440220435dd564c711c4b91344e31e342596a51772d62387c98e7158d95cd420dce24902201181a4626f11a7df4758970aff6e2914cb98b6be522a58c6ce005af3a8aa72f7ac5f1a078b610d92a3110b2c1a7f880b0d2442e5307f969800000000000000000000000000000000000000000000000000000000000000000000000000000201000000010164901a25fcf7d00af2dc3d21654d1adac6ce04f90510fa1c60dd4172129b12a0010000006a473044022062e7fd7d24fc802dadc4fe522957e55779a93e1aa5f97b538c8de83be7471ada02200bba5bdab0b12ae76f9ee7a97dd083f609e5852c8c55d77cbc910827c297617001210276c52ff14acd4c4d3e08f9596e0127a15e98207b3d0024426364825cd724c86dffffffff0200e8764817000000000000001976a9145f1a078b610d92a3110b2c1a7f880b0d2442e53088ac0078e1bb806b1c00000000001976a914bb7e4d6ffb3266a0b533b21847bef4dacce95f4688ac93bd69590000000000060100000093bd695900000000822103e8769d1901a4ef006054405c16716d6648fffe628385db5586c7fa18c3df5da876a914df639c6066a817a6be28b532839f8e1e85594cd48846304402201a073c3a3de562dd709dfb31022d799880e018b9b70905056267636d21f805f402206719f0a577ca1b16a242986c1d89a4f34ad14641461c4e1d2aa6a856cab0eb31acdf639c6066a817a6be28b532839f8e1e85594cd47f969800000000000000000000000000000000000000000000000000000000000000000000000000000201000000010156a30cd409eef260b1f658d548c0929e289bd89c7ced1c1ccfb471ed6a627cda010000006a47304402207481794a28775190a82729d3e2f4afb6510da3bdd8c2a6c27831c77d2847f65502203335c72091176d72460e4ae81ef0284b59e529a898adca78e4064ebc1b79b57f01210276c52ff14acd4c4d3e08f9596e0127a15e98207b3d0024426364825cd724c86dffffffff0200e8764817000000000000001976a914df639c6066a817a6be28b532839f8e1e85594cd488ac00906a73696b1c00000000001976a914bb7e4d6ffb3266a0b533b21847bef4dacce95f4688ac93bd69590000000000060100000093bd695900000000832103368f8061e02694e37da199c07c3e2f2506cdd748efee493f0d1c52ae7494428f76a914e3453a80144f6ac24baf01f20455c6167b98548588473045022100da2c94fd3348838dcb1b628620537477cf1ce496801e8458e2f13ee0ab7b0c5402201fa4ece06a1544beae191c28d5e6b1e793bce7d225c5e1d78c51cc805a29f2d2ace3453a80144f6ac24baf01f20455c6167b9854857f96980000000000000000000000000000000000000000000000000000000000000000000000000000020100000001011b2cd9346979830ea6e9fae246f112c46dbd52ab6b1c3aae498b34922e669d21010000006b4830450221008d9138caae9e5a567991a00bafe820b32b316bec304df2e951964884e55046f0022033b2745d25d7b6cc71d169fb50cb8f184af580e14f39de24de0542231eff233101210276c52ff14acd4c4d3e08f9596e0127a15e98207b3d0024426364825cd724c86dffffffff0200e8764817000000000000001976a914e3453a80144f6ac24baf01f20455c6167b98548588ac00a8f32a526b1c00000000001976a914bb7e4d6ffb3266a0b533b21847bef4dacce95f4688ac93bd69590000000000"));

		Sha256Hash merkleHash = gengsisBlock.getBlock().buildMerkleHash();

		if(log.isDebugEnabled()) {
			log.debug("the gengsis block merkle hash is : {}", merkleHash);
		}
		Utils.checkState("c78001cd9d306a5ccaa0a3cf72390910bd82e12eecac71152948b0c16725d08f".equals(Hex.encode(merkleHash.getBytes())), "the gengsis block merkle hash is error");

		if(log.isDebugEnabled()) {
			log.debug("the gengsis block hash key is : {}", gengsisBlock.getBlock().getHash());
		}
		Utils.checkState("814d30c95a8f4818ea2d1b4752198db10d91ebcab477d25696a3fe233be9577d".equals(Hex.encode(gengsisBlock.getBlock().getHash().getBytes())), "the gengsis block hash is error");

		return gengsisBlock;

	}
	
	@Override
	public int getProtocolVersionNum(ProtocolVersion version) {
		return version.getVersion();
	}

	@Override
	public MessageSerializer getSerializer(boolean parseRetain) {
		return new DefaultMessageSerializer(this);
	}

	/**
	 * 获取该网络的认证管理账号的hash160
	 * @return byte[]
	 */
	@Override
	public byte[] getCertAccountManagerHash160() {


		//return Hex.decode("8e168bb4963f0523b9ee1c734d3c142976581930");//root
		//return Hex.decode("b326aeb9c6710864441b7c6a282ce924b4c31749");//manager
		return Hex.decode("481e05c83604abf86cca029c4260674c45c85c58");//cer_manager_1
	}

	@Override
	public byte[] getCommunityManagerHash160() {
		return Hex.decode("481e05c83604abf86cca029c4260674c45c85c58");//cer_manager_1
	}

	/**
	 * 测试网络，普通地址以t开头
	 */
	@Override
	public int getSystemAccountVersion() {
		return 128;
	}

	/**
	 * 测试网络，认证地址以c开头
	 */
	@Override
	public int getCertAccountVersion() {
		return 88;
	}
}
